# Часть 6. Вход и выход из панели администратора с помощью Auth Guard
В этой части мы реализуем функционал входа и выхода администратора с помощью ***Laravel Guards***. При входе администратора в систему мы зарегистрируем ```Admin Guard```, а при выходе из системы — корректно его уничтожим.

Что вы узнаете из этого видео:
- Обновите форму входа администратора в ```login.blade.php```
- Реализуйте аутентификацию администратора с помощью ```Auth::guard('admin')```
- Перенаправление после успешного входа и обработка недействительных учетных данных
- Добавить функцию выхода из системы в ```header.blade.php```
- Удалите ненужные разделы из заголовка панели администратора.
- Создайте маршрут для выхода из системы в ```web.php```
- Обновите функцию ```destroy()``` в ```AdminController```.
- Отображать сообщения об ошибках при неудачных попытках входа в систему
## Шаг 1. Обновите ```login.blade.php``` (форма входа администратора)
Измените форму входа администратора, чтобы задать ее действие, токен CSRF и поля ввода для адреса электронной почты и пароля.
```
<form action="{{ route('admin.login.request') }}" method="post">@csrf
    <input name="email" type="email" class="form-control" placeholder="Email">
    <input name="password" type="password" class="form-control" placeholder="Password">
    <button type="submit" class="btn btn-primary btn-block">Sign In</button>
</form>
```
## Шаг 2. Добавьте маршрут входа администратора в ```web.php```
Убедитесь, что маршрут ```POST``` для входа добавлен правильно:
```
Route::prefix('admin')->group(function () {
    // Show login form
    Route::get('login', [AdminController::class, 'create'])->name('admin.login');
    // Handle login form submission
    Route::post('login', [AdminController::class, 'store'])->name('admin.login.request');
    Route::group(['middleware' => ['admin']], function () {
        // Dashboard route
        Route::resource('dashboard', AdminController::class)->only(['index']);
    });
});
```
## Шаг 3. Обновите функцию ```store()``` в ```AdminController```
Измените функцию ```store()``` для обработки аутентификации администратора с помощью ```Auth::guard('admin')```.
```
public function store(Request $request)
{
    $data = $request->all();
    if (Auth::guard('admin')->attempt(['email' => $data['email'], 'password' => $data['password']])) {
        return redirect()->route('dashboard.index');
    } else {
        return redirect()->back()->with('error_message', 'Invalid Email or Password');
    }
}
```
Тестовый вход:

Используйте следующие учетные данные (созданы в предыдущей части с помощью Seeding):
- Электронная почта: admin@mail.ru
- Пароль: 123456
## Шаг 4. Обновите ```header.blade.php``` (заголовок панели администратора и ссылка выхода)
Измените заголовок панели администратора, удалив ненужный код и добавив ссылку для выхода из системы.

Удалите следующий код из заголовка:
```
<!--begin::Navbar Search-->
---
<!--end::Messages Dropdown Menu-->
<!--begin::Menu Body-->
---
<!--end::Menu Body-->
```
На данный момент отключите следующий раздел:
```
<!--begin::Notifications Dropdown Menu-->
---
<!--end::Notifications Dropdown Menu-->
```
Добавить опцию выхода из системы:
```
<a href="{{ url('admin/logout') }}" class="btn btn-default btn-flat float-end"> Sign out</a>
```
Отображение имени вошедшего в систему администратора:
```
{{ Auth::guard('admin')->user()->name }}
```
## Шаг 5. Создайте маршрут выхода из системы в ```web.php```

Определите маршрут выход из системы ```logout```:
```
// Admin Logout
Route::get('logout', [AdminController::class, 'destroy'])->name('admin.logout');
```
## Шаг 6. Обновите функцию ```destroy()``` в ```AdminController```
Выполните выход администратора из системы, отменив сеанс охраны.
```
public function destroy()
{
    Auth::guard('admin')->logout();
    return redirect()->route('admin.login');
}
```
## Шаг 7. Отображение сообщений об ошибках в ```login.blade.php```
Показывать сообщения об ошибках при неудачной попытке входа в систему.
```
@if(Session::has('error_message'))
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <strong>Ошибка:</strong> {{ Session::get('error_message') }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
@endif
```
# Что дальше?
В [следующей части](07.md) мы проверим вход администратора с помощью класса ```Validator``` от Laravel и проверки пользовательских запросов для повышения безопасности форм.
[Оглавление](../README.md)
