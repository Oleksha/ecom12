# Часть 24. Модуль «Категории» (VI) | Активный/Неактивный и удаление категорию
В этой части мы улучшим модуль категорий, реализовав следующие функции:
- Изменить статус категории (активно/неактивно)
- Удалить категорию

Эти функции необходимы для поддержания чистоты и управляемости данных категорий в вашей панели администратора.
## Шаг 1. Обновите ```categories/index.blade.php``` для отображения значков статуса.
Сначала давайте обновим представление Blade для отображения значков состояния с помощью Font Awesome:
```
@if($category->status == 1)
    <a class="updateCategoryStatus me-2"
       data-category-id="{{ $category->id }}"
       style="color: #3f6ed3" href="javascript:void(0)"><i class="fas fa-toggle-on" data-status="Active"></i></a>
@else
    <a class="updateCategoryStatus me-2"
       data-category-id="{{ $category->id }}"
       style="color: grey" href="javascript:void(0)"><i class="fas fa-toggle-off" data-status="Inactive"></i></a>
@endif
```
## Шаг 2. Добавьте логику jQuery в ```custom.js``` для обновления статуса AJAX
Затем добавьте код jQuery для обработки переключения статуса без обновления страницы:
```
// Update Category Status
$(document).on("click", ".updateCategoryStatus", function(){
    let status = $(this).children('i').data('status');
    let category_id = $(this).data('category-id');
    $.ajax({
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        },
        type: "POST",
        url: "/admin/update-category-status",
        data: { status: status, category_id: category_id},
        success: function (response) {
            if (response['status'] === 0) {
                $("a[data-category-id='" + category_id + "']").html("<i class='fa fa-toggle-off' style='color: gray' data-status='Inctive'></i>");
            } else if (response['status'] === 1) {
                $("a[data-category-id='" + category_id + "']").html("<i class='fa fa-toggle-on' style='color: #3f6ed3' data-status='Active'></i>");
            }
        },
        error: function () {
            alert("Error");
        }
    });
});
```
## Шаг 3. Создать маршрут для обновления статуса
Добавьте следующий маршрут ```POST``` в файл ```web.php```:
```
Route::post('update-category-status', [CategoryController::class, 'updateCategoryStatus']);
```
## Шаг 4. Создайте метод ```updateCategoryStatus``` в ```CategoryController```. 
В вашем ```Category Controller``` определите метод для получения данных ```AJAX```:
```
public function updateCategoryStatus(Request $request)
{
    if ($request->ajax()) {
        $data = $request->all();
        $status = $this->categoryService->updateCategoryStatus($data);
        return response()->json(['status' => $status, 'category_id' => $data['category_id']]);
    }
}
```
## Шаг 5. Создайте метод ```updateCategoryStatus``` в ```CategoryService```
Теперь в вашем ```CategoryService``` добавьте логику для обновления статуса категории в базе данных:
```
public function updateCategoryStatus(array $data): int
{
    $status = ($data['status'] == 'Active') ? 0 : 1;
    Category::where('id', $data['category_id'])->update(['status' => $status]);
    return $status;
}
```
# Функционал удаления категорий
## Шаг 6. Добавить значок «Удалить» в представление Blade
Обновите ```categories/index.blade.php```, включив функцию удаления с помощью формы DELETE рядом с каждой категорией:
```
<form action="{{ route('categories.destroy', $category->id) }}"
      method="POST" style="display: inline-block"
      onsubmit="return confirm('Are you sure to delete this category?')">
    @csrf
    @method('DELETE')
    <button type="submit" style="border: none; background: none; color: #3f6ed3"><i class="fas fa-trash"></i></button>
</form>
```
## Шаг 7. Обновите метод ```Destroy``` в ```CategoryController```
В контроллере вызовите функцию ```deleteCategory``` из ```CategoryService``` для обработки запроса на удаление:
```
public function destroy(string $id)
{
    $result = $this->categoryService->deleteCategory($id);
    return redirect()->back()->with('success_message', $result['message']);
}
```
## Шаг 8. Обработка удаления в ```CategoryService```
Добавьте логику удаления в ```CategoryService``` для окончательного удаления категории:
```
public function deleteCategory(string $id): array
{
    Category::where('id', $id)->delete();
    $message = 'Category deleted successfully!';
    return ['message' => $message];
}
```
Конечный результат этой части:
- Мгновенное переключение статуса категории через AJAX
- Безопасное удаление категории из панели администратора
# Что дальше?
В [следующей части](25.md) реализуем:
- Посмотреть изображение категории и таблицу размеров
- Удалить изображение категории и таблицу размеров (с удалением файла из хранилища)

[Оглавление](../README.md)
