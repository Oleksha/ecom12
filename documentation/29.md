# Часть 29. Модуль «Продукты» (II) | Отображение продуктов в панели администратора с помощью DataTable и разрешений
В этой части мы отобразим список товаров в панели администратора с помощью DataTable, а также настроим права доступа администратора и субадминистратора с помощью модели AdminsRole. Это важный шаг в управлении ассортиментом товаров с позиции администратора.
## Шаг 1. Определить маршрут
Добавьте следующий маршрут в группу административного промежуточного программного обеспечения в route/web.php для управления всеми операциями, связанными с продуктом, на панели администратора:
```php
// Products
Route::resource('products', ProductController::class);
```
## Шаг 2. Создать сервис продукта

Создайте класс сервиса в каталоге ```app/Services/Admin/``` для обработки бизнес-логики операций, связанных с продуктом.

Файл: ```app/Services/Admin/ProductService.php```
```php
<?php
namespace App\Services\Admin;

class ProductService
{

}
```
## Шаг 3. Включите требуемые модели в ProductService
Добавьте следующие импорты моделей в начало ```ProductService.php```:
```php
use App\Models\AdminsRole;
use App\Models\Product;
use Illuminate\Support\Facades\Auth;
```
## Шаг 4. Реализуйте метод products() в ProductService
Добавьте следующий метод в ```ProductService.php``` для извлечения всех продуктов и их прав администратора/субадминистратора:
```php
public function products(): array
{
    $products = Product::get();

    // Set Admin/Subadmin Permissions for Products
    $productsModuleCount = AdminsRole::where([
        'subadmin_id' => Auth::guard('admin')->user()->id,
        'module' => 'products',
    ])->count();
    $status = 'success';
    $message = '';
    $productsModule = [];
    if (Auth::guard('admin')->user()->role == 'admin') {
        $productsModule = [
            'view_access' => 1,
            'edit_access' => 1,
            'full_access' => 1,
        ];
    } elseif ($productsModuleCount == 0) {
        $status = 'error';
        $message = 'This feature is restricted for you!';
    } else {
        $productsModule = AdminsRole::where([
            'subadmin_id' => Auth::guard('admin')->user()->id,
            'module' => 'products',
        ])->first()->toArray();
    }
    return [
        'products' => $products,
        'productsModule' => $productsModule,
        'status' => $status,
        'message' => $message,
    ];
}
```
## Шаг 5. Внедрение ProductService в ProductController
Используйте внедрение зависимостей на основе конструктора для включения ```ProductService``` в файл ```ProductController.php```:
```php
namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Services\Admin\ProductService;
use Illuminate\Http\Request;

class ProductController extends Controller
{
    public function __construct(
        protected ProductService $productService,
    )
    {}
}
```
## Шаг 6. Обновите метод index() в ProductController
Измените метод ```index()``` для вызова ```products()``` из ```ProductService``` и передачи данных в представление:
```php
public function index()
{
    Session::put('page', 'products');
    $result = $this->productService->products();
    if ($result['status'] == 'error') {
        return redirect('admin/dashboard')->with('error_message', $result['message']);
    }
    return view('admin.products.index', [
        'products' => $result['products'],
        'productsModule' => $result['productsModule']
    ]);
}
```
## Шаг 7. Создайте Blade-файл для отображения продуктов
Создайте файл ```index.blade.php``` внутри кода для отображения таблицы с использованием макета AdminLTE: ```resources/views/admin/products/``` и добавьте следующее
```html
<table id="products" class="table table-bordered table-striped">
    <thead>
    <tr>
        <th>ID</th>
        <th>Product Name</th>
        <th>Product Code</th>
        <th>Product Color</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    @foreach($products as $product)
        <tr>
            <td>{{ $product->id }}</td>
            <td>{{ $product->product_name }}</td>
            <td>{{ $product->product_code }}</td>
            <td>{{ $product->product_color }}</td>
            <td>
                <!-- Actions (Enable/Disable, Edit, Delete) will be added here -->
            </td>
        </tr>
    @endforeach
    </tbody>
</table>
```
## Шаг 8. Включить DataTable
Инициализируйте функциональность ```DataTable``` для продуктов в файле ```scripts.blade.php```:
```js
<script>
    $(document).ready(function(){
        $("#products").DataTable();
        $("#categories").DataTable();
        $("#subadmins").DataTable();
    });
</script>
```
# Что дальше?
В [следующей части](30.md) мы добавим функции включения/отключения продуктов и реализуем логику удаления продуктов в панели администратора.

[Оглавление](../README.md)
