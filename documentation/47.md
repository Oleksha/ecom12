# Часть 47. Модуль брендов (III): добавление и редактирование функциональности бренда
В этой части мы продолжаем работу над модулем брендов и реализуем полную функциональность добавления/редактирования брендов.
## Шаг 1. Обновление index.blade.php (страница списка брендов)
Добавьте кнопку «Добавить бренд» в правый верхний раздел:
```html
<a style="max-width: 250px; float:right; display: inline-block;"
   href="{{ route('brands.create') }}" class="btn btn-block btn-primary">
    Добавить бренд
</a>
```
Добавьте значок «Изменить» в столбец «Действие» для каждого бренда:
```html
<a class="me-2" href="{{ route('brands.edit', $brand->id) }}"><i class="fas fa-edit"></i></a>
```
## Шаг 2. Настройка маршрута ресурса
Мы используем ресурсные маршруты Laravel по умолчанию в файле **routes/web.php** (внутри группы промежуточного ПО администратора):
```php
Route::resource('brands', BrandController::class);
```
## Шаг 3. Обновление методов BrandController
**Показать форму добавления бренда**
```php
public function create()
{
    $title = 'Add Brand';
    return view('admin.brands.add_edit_brand', compact('title'));
}
```
**Обработка добавления бренда**
```php
public function store(Request $request)
{
    $messages = $this->brandService>addEditBrand($request);
    return redirect()->route('brands.index')->with('success_message', $messages);
}
```
**Показать форму изменения бренда**
```php
public function edit(string $id)
{
    $title = 'Edit Brand';
    $brand = Brand::findOrFail($id);
    return view('admin.brands.add_edit_brand', compact('title', 'brand'));
}
```
**Обработка изменения бренда**
```php
public function update(Request $request, string $id)
{
    $request->merge(['id' => $id]);
    $message = $this->brandService->addEditBrand($request);
    return redirect()->route('brands.index')->with('success_message', $message);
}
```
Эти методы следуют соглашениям RESTful-контроллера Laravel, обеспечивая чистый и поддерживаемый код.
## Шаг 4. Создайте add_edit_brand.blade.php (Форма представления)
Мы создаем один Blade-файл для операций добавления и редактирования.

Он включает в себя:
- Поля формы для: названия бренда, изображения, логотипа, скидки, URL-адреса, описания, meta-заголовка,
- Мета-описание и мета-ключевые слова
- Отображение существующего изображения и логотипа при редактировании
- Обработка условных маршрутов для хранения и обновления
- Также обновите миграцию брендов со столбцом menu_status, который нам нужен, чтобы сделать бренд активным или неактивным в меню заголовка.
```html
<form name="brandForm" id="brandForm" method="post"
      action="{{ isset($brand->id) ? route('brands.update', $brand->id) : route('brands.store') }}"
      enctype="multipart/form-data">@csrf
    @if(isset($brand->id)) @method('PATCH') @endif
    <!--begin::Body-->
    <div class="card-body">
        <div class="mb-3">
            <label for="name" class="form-label">Имя бренда*</label>
            <input type="text" class="form-control" id="name"
                   name="name" placeholder="Введите имя бренда"
                   value="{{ old('name', $brand->name ?? '') }}">
        </div>
        <div class="mb-3">
            <label for="image" class="form-label">Изображение бренда</label>
            <input type="file" class="form-control" id="image"
                   name="image" accept="image/*">
            @if(!empty($brand->image))
                <div class="mt-2" id="brandImageBlock">
                    <a target="_blank" href="{{ asset('front/images/brands/' . $brand->image) }}"><img src="{{ asset('front/images/brands/' . $brand->image) }}" width="50" alt="Изображение бренда"></a>
                    <a href="javascript:void(0)" id="deleteBrandImage" data-brend-id="{{ $brand->id }}" class="text-danger">Delete</a>
                </div>
            @endif
        </div>
        <div class="mb-3">
            <label for="logo" class="form-label">Логотип бренда</label>
            <input type="file" class="form-control" id="logo"
                   name="logo" accept="image/*">
            @if(!empty($brand->logo))
                <div class="mt-2" id="brandLogoBlock">
                    <a target="_blank" href="{{ asset('front/images/logos/' . $brand->logo) }}"><img src="{{ asset('front/images/logos/' . $brand->logo) }}" width="50" alt="Логотип бренда"></a>
                    <a href="javascript:void(0)" id="deleteLogoImage" data-brend-id="{{ $brand->id }}" class="text-danger">Delete</a>
                </div>
            @endif
        </div>
        <div class="mb-3">
            <label for="brand_discount" class="form-label">Скидка бренда</label>
            <input type="text" class="form-control" placeholder="Введите скидку бренда"
                   id="brand_discount" name="brand_discount"
                   value="{{ old('brand_discount', $brand->discount ?? '') }}">
        </div>
        <div class="mb-3">
            <label for="url" class="form-label">URL бренда*</label>
            <input type="text" class="form-control" placeholder="Введите URL бренда"
                   id="url" name="url"
                   value="{{ old('url', $brand->url ?? '') }}">
        </div>
        <div class="mb-3">
            <label for="description" class="form-label">Описание бренда</label>
            <textarea class="form-control" rows="3" id="description"
                      name="description" placeholder="Введите описание">
                {{ old('description', $brand->description ?? '') }}
            </textarea>
        </div>
        <div class="mb-3">
            <label for="meta_title" class="form-label">Meta-Заголовок</label>
            <input type="text" class="form-control"
                   placeholder="Введите Meta-Заголовок"
                   id="meta_title" name="meta_title"
                   value="{{ old('meta_title', $brand->meta_title ?? '') }}">
        </div>
        <div class="mb-3">
            <label for="meta_description" class="form-label">Meta-Описание</label>
            <input type="text" class="form-control"
                   placeholder="Введите Meta-Описание"
                   id="meta_description" name="meta_description"
                   value="{{ old('meta_description', $brand->meta_description ?? '') }}">
        </div>
        <div class="mb-3">
            <label for="meta_keywords" class="form-label">Meta-Ключевые слова</label>
            <input type="text" class="form-control"
                   placeholder="Введите Meta-Ключевые слова"
                   id="meta_keywords" name="meta_keywords"
                   value="{{ old('meta_keywords', $brand->meta_keywords ?? '') }}">
        </div>
        <div class="mb-3">
            <label for="menu_status" class="form-check-label">Показывать в главном меню</label><br>
            <input type="checkbox" name="menu_status"
                   id="menu_status" class="form-check-input"
                   value="1" {{ !empty($brand->menu_status) ? 'checked' : '' }}>
        </div>
    </div>
    <!--end::Body-->
    <!--begin::Footer-->
    <div class="card-footer">
        <button type="submit" class="btn btn-primary">Submit</button>
    </div>
    <!--end::Footer-->
</form>
```
Реализован полноценный дизайн формы с административным стилем и предварительным просмотром условных изображений/размеров.
## Шаг 5. Создайте addEditBrand() в BrandService
Обрабатывает логику вставки и обновления в одном методе:
- Загрузка файлов с помощью Intervention Image
- Изменение размера и сохранение изображения
- Форматирование URL-слага
- Очистка входных данных и значения по умолчанию
- Сохранение данных в таблицу брендов
```php
public function addEditBrand(Request $request): string
{
    $data = $request->all();

    if (isset($data['id']) && $data['id'] != '') {
        // Изменение бренда
        $brand = Brand::find($data['id']);
        $message = 'Бренд обновлен!';
    } else {
        // Добавление бренда
        $brand = new Brand();
        $message = 'Бренд создан!';
    }

    // Загрузка изображения бренда
    if ($request->hasFile('image')) {
        $image_tmp = $request->file('image');
        if ($image_tmp->isValid()) {
            $manager = new ImageManager(new Driver());
            $image = $manager->read($image_tmp);
            $extension = $image_tmp->getClientOriginalExtension();
            $imageName = rand(111, 9999) . '.' . $extension;
            $imagePath = 'front/images/brands/' . $imageName;
            $image->save($imagePath);
            $brand->image = $imageName;
        }
    }
    // Загрузка логотипа бренда
    if ($request->hasFile('logo')) {
        $image_logo = $request->file('logo');
        if ($image_logo->isValid()) {
            $manager = new ImageManager(new Driver());
            $image = $manager->read($image_logo);
            $extension = $image_logo->getClientOriginalExtension();
            $logoName = rand(111, 9999) . '.' . $extension;
            $logoPath = 'front/images/logos/' . $logoName;
            $image->save($logoPath);
            $brand->logo = $logoName;
        }
    }
    // Форматирование имени и URL
    $data['name'] = str_replace('-', ' ', mb_convert_case(mb_strtolower($data['name']), MB_CASE_TITLE, "UTF-8"));
    $data['url'] = str_replace(' ', '-', mb_strtolower($data['url']));

    $brand->name = $data['name'];

    // Скидка по умолчанию
    if (empty($data['brand_discount']))  $data['brand_discount'] = 0;

    $brand->discount = $data['brand_discount'];
    $brand->description = $data['description'];
    $brand->url = $data['url'];
    $brand->meta_title = $data['meta_title'];
    $brand->meta_description = $data['meta_description'];
    $brand->meta_keywords = $data['meta_keywords'];

    // Menu Status
    if (!empty($data['menu_status'])) {
        $brand->menu_status = 1;
    } else {
        $brand->menu_status = 0;
    }

    // Статус по умолчанию
    $brand->status = 1;
    
    $brand->save();
    
    return $message;
}
```
## Шаг 6. Обязательно импорт заголовков
В верхней части файла **BrandService.php** добавьте:
```php
use Illuminate\Http\Request;
use Intervention\Image\Drivers\Gd\Driver;
use Intervention\Image\ImageManager;
```
## Шаг 7. Показать сообщение об успешном завершении в index.blade.php
Отобразить флэш-сообщение после успешного добавления/обновления бренда:
```html
@if(Session::has('success_message'))
    <div class="alert alert-success alert-dismissible fade show m-3" role="alert">
        <strong>Успешно: </strong> {{ Session::get('success_message') }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
@endif
```
Также обновите боковую панель администратора, включив в нее раздел «Бренды»:
```html
<div class="sidebar-brand">
    <!--begin::Brand Link-->
    <a href="#" class="brand-link">
        <!--begin::Brand Image-->
        <img
            src="{{ asset('admin/images/AdminLTELogo.png') }}"
            alt="AdminLTE Logo"
            class="brand-image opacity-75 shadow"
        />
        <!--end::Brand Image-->
        <!--begin::Brand Text-->
        <span class="brand-text fw-light">AdminLTE 4</span>
        <!--end::Brand Text-->
    </a>
    <!--end::Brand Link-->
</div>
<!--end::Sidebar Brand-->
<!--begin::Sidebar Wrapper-->
<div class="sidebar-wrapper">
    <nav class="mt-2">
        <!--begin::Sidebar Menu-->
        <ul
            class="nav sidebar-menu flex-column"
            data-lte-toggle="treeview"
            role="menu"
            data-accordion="false"
        >
            <li class="nav-item {{ in_array(Session::get('page'), ['dashboard', 'update-password', 'update-details', 'subadmins']) ? 'menu-open' : '' }}">
                <a href="#" class="nav-link {{ in_array(Session::get('page'), ['dashboard', 'update-password', 'update-details', 'subadmins']) ? 'active' : '' }}">
                    <i class="nav-icon bi bi-speedometer"></i>
                    <p>
                        Управление
                        <i class="nav-arrow bi bi-chevron-right"></i>
                    </p>
                </a>
                <ul class="nav nav-treeview">
                    <li class="nav-item">
                        <a href="{{ url('admin/dashboard') }}" class="nav-link {{ (Session::get('page') == 'dashboard') ? 'active' : '' }}">
                            <i class="nav-icon bi bi-circle"></i>
                            <p>Dashboard</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{ route('admin.update-password') }}" class="nav-link {{ (Session::get('page') == 'update-password') ? 'active' : '' }}">
                            <i class="nav-icon bi bi-circle"></i>
                            <p>Update Password</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{ route('admin.update-details') }}" class="nav-link {{ (Session::get('page') == 'update-details') ? 'active' : '' }}">
                            <i class="nav-icon bi bi-circle"></i>
                            <p>Update Details</p>
                        </a>
                    </li>
                    @if(Auth::guard('admin')->user()->role == 'admin')
                        <!-- Admins / Sub Admins -->
                        <li class="nav-item">
                            <a href="{{ url('admin/subadmins') }}" class="nav-link {{ (Session::get('page') == 'subadmins') ? 'active' : '' }}">
                                <i class="nav-icon bi bi-circle"></i>
                                <p>Subadmins</p>
                            </a>
                        </li>
                    @endif
                </ul>
            </li>
            <li class="nav-item {{ in_array(Session::get('page'), ['categories', 'brands', 'products']) ? 'menu-open' : '' }}">
                <a href="#" class="nav-link {{ in_array(Session::get('page'), ['categories', 'brands', 'products']) ? 'active' : '' }}">
                    <i class="nav-icon bi bi-clipboard-fill"></i>
                    <p>
                        Каталог
                        <i class="nav-arrow bi bi-chevron-right"></i>
                    </p>
                </a>
                <ul class="nav nav-treeview">
                    <li class="nav-item">
                        <a href="{{ route('categories.index') }}" class="nav-link {{ (Session::get('page') == 'categories') ? 'active' : '' }}">
                            <i class="nav-icon bi bi-circle"></i>
                            <p>Категории</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{ route('brands.index') }}" class="nav-link {{ (Session::get('page') == 'brands') ? 'active' : '' }}">
                            <i class="nav-icon bi bi-circle"></i>
                            <p>Бренды</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a href="{{ route('products.index') }}" class="nav-link {{ (Session::get('page') == 'products') ? 'active' : '' }}">
                            <i class="nav-icon bi bi-circle"></i>
                            <p>Продукты</p>
                        </a>
                    </li>
                </ul>
            </li>
        </ul>
        <!--end::Sidebar Menu-->
    </nav>
</div>
```
К концу этой части вы сможете динамически добавлять и редактировать бренды из панели администратора.
# Что дальше?
В [следующей части](48.md) мы добавим проверку в форму добавления/редактирования бренда, чтобы гарантировать корректный ввод данных.

[Оглавление](../README.md)
