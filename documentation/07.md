# Часть 7. Подтвердить форму входа администратора | Проверка пользовательского запроса
В начале этой серии я обещал использовать Requests & Services для лучшей структуры кода.

В этой части мы впервые реализуем проверку запросов, а в следующей части мы познакомимся с классами обслуживания.
## Зачем использовать запросы?
Проверка запросов форм Laravel помогает отделить логику проверки от контроллеров, делая код более чистым, пригодным для повторного использования и простым в управлении.

Мы проверим форму входа администратора, используя класс ```Validator``` Laravel и проверку пользовательских запросов для повышения безопасности и удобства пользователя.

Что вы узнаете в этой части:
- Создайте индивидуальный запрос на проверку имени администратора
- Применить правила проверки для адреса электронной почты и пароля
- Показывать пользовательские сообщения об ошибках при недопустимых входных данных
- Включить класс ```LoginRequest``` в ```AdminController```
- Обновите ```AdminController@store```, чтобы использовать проверенный запрос.
- Отображение ошибок проверки в ```login.blade.php```

## Шаг 1. Создать класс ```LoginRequest```

Сначала мы выполним следующую команду ```Artisan``` для создания ```LoginRequest``` в папке ```Admin```:
```
php artisan make:request Admin/LoginRequest
```
Теперь обновите ```LoginRequest.php```, чтобы определить правила проверки и пользовательские сообщения об ошибках:
```
public function rules(): array
{
    return [
        'email' => 'required|email|max:255',
        'password' => 'required',
    ];
}
public function messages(): array
{
    return [
        'email.required' => 'Поле Email должно быть заполнено',
        'email.email' => 'Email не действительный',
        'password.required' => 'Поле Password должно быть заполнено',
    ];
}
```
Также верните ```true``` в методе ```authorize```:
```
public function authorize(): bool
{
    return true;
}
```
## Шаг 2. Включить класс ```LoginRequest``` в ```AdminController```
Перед обновлением функции ```store()``` нам необходимо импортировать класс ```LoginRequest``` в начало ```AdminController.php```:
```
use App\Http\Requests\Admin\LoginRequest;
```
## Шаг 3. Обновите функцию ```store()``` в ```AdminController```
Измените функцию ```store()```, чтобы использовать ```LoginRequest``` для проверки формы:
```
public function store(LoginRequest $request)
{
    $data = $request->all();
    if (Auth::guard('admin')->attempt(['email' => $data['email'], 'password' => $data['password']])) {
        return redirect()->route('dashboard.index');
    } else {
        return redirect()->back()->with('error_message', 'Invalid Email or Password');
    }
}
```
## Шаг 4. Обновите ```login.blade.php``` для отображения ошибок.
Поскольку мы уже настроили действие формы в части 6, теперь мы обновим файл для отображения ошибок проверки.

Добавьте следующую логику отображения сообщения об ошибке в ```login.blade.php```:
```
@foreach($errors->all() as $error)
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <strong>Ошибка!</strong> {!! $error !!}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
@endforeach
```
# Что дальше?
В [следующей части](08.md) мы рассмотрим класс ```AdminService```, который отделит всю логику, связанную с администрированием, от контроллера, сохраняя код чистым и удобным для обслуживания.
[Оглавление](../README.md)
