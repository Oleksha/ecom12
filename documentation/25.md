# Часть 25. Модуль «Категории» (VII) | Удаление изображение категории и иконок через AJAX
## Шаг 1. Удалить изображение категории через AJAX
**Обновление вида** ```add_edit_category.blade.php```:

Добавьте ссылку «Удалить изображение категории» в файл ```add_edit_category.blade.php```:
```
@if(!empty($category->image))
    <div class="mt-2" id="categoryImageBlock">
        <a target="_blank" href="{{ asset('front/images/categories/' . $category->image) }}"><img src="{{ asset('front/images/categories/' . $category->image) }}" width="50" alt="Изображение"></a>
        <a href="javascript:void(0)" id="deleteCategoryImage" data-category-id="{{ $category->id }}" class="text-danger">Delete</a>
    </div>
@endif
```
**Добавьте jQuery в custom.js**:

Добавьте следующую функцию jQuery в файл ```custom.js``` для удаления изображения категории через AJAX:
```
$(document).on("click", "#deleteCategoryImage", function(){
    if (confirm('Are you sure you want to remove this Category Image?')) {
        let category_id = $(this).data('category-id');
        $.ajax({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            },
            type: "POST",
            url: "/admin/delete-category-image",
            data: { category_id: category_id},
            success: function (response) {
                if (response['status'] === true) {
                    alert(response['message']);
                    $('#categoryImageBlock').remove();
                }
            },
            error: function () {
                alert("Error occurred while deleting the image.");
            }
        });
    }
});
```
**Создайте маршрут для удаления изображения категории в файле web.php**:
```
Route::post('delete-category-image', [CategoryController::class, 'deleteCategoryImage']);
```
**Добавьте функцию deleteCategoryImage в CategoryController**:
```
public function deleteCategoryImage(Request $request)
{
    $status = $this->categoryService->deleteCategoryImage($request->category_id);
    return response()->json($status);
}
```
**Добавьте deleteCategoryImage в CategoryService**:

Мы удалим изображение категории из папки и базы данных:
```
public function deleteCategoryImage($categoryId): array
{
    $categoryImage = Category::where('id', $categoryId)->value('image');
    if ($categoryImage) {
        $categoryImagePath = 'front/images/categories/' . $categoryImage;
        if (file_exists(public_path($categoryImagePath))) {
            unlink(public_path($categoryImagePath));
        }
        Category::where('id', $categoryId)->update(['image' => null]);
        return ['status' => true, 'message' => 'Category image deleted successfully!'];
    }
    return ['status' => false, 'message' => 'Category image not found!'];
}
```
## Шаг 2. Удалить иконку для бокового меню через AJAX
**Обновление вида** ```add_edit_category.blade.php```:
```
@if(!empty($category->size_chart))
    <div class="mt-2" id="size-chartImageBlock">
        <a target="_blank" href="{{ asset('front/images/size-charts/' . $category->size_chart) }}"><img src="{{ asset('front/images/size-charts/' . $category->size_chart) }}" width="50" alt="Size Chart"></a>
        <a href="javascript:void(0)" id="deleteSizeChartImage" data-category-id="{{ $category->id }}" class="text-danger">Delete</a>
    </div>
@endif
```
**Добавьте jQuery в custom.js**:
```
$(document).on("click", "#deleteSizeChartImage", function(){
    if (confirm('Are you sure you want to remove this Size Chart Image?')) {
        let category_id = $(this).data('category-id');
        $.ajax({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            },
            type: "POST",
            url: "/admin/delete-size-chart-image",
            data: { category_id: category_id},
            success: function (response) {
                if (response['status'] === true) {
                    alert(response['message']);
                    $('#size-chartImageBlock').remove();
                }
            },
            error: function () {
                alert("Error occurred while deleting the image.");
            }
        });
    }
});
```
**Создайте маршрут в файле web.php**:
```
Route::post('delete-size-chart-image', [CategoryController::class, 'deleteSizeChartImage']);
```
**Добавьте функцию deleteSizeChartImage в CategoryController**:
```
public function deleteSizeChartImage(Request $request)
{
    $status = $this->categoryService->deleteSizeChartImage($request->category_id);
    return response()->json($status);
}
```
**Добавьте deleteSizeChartImage в CategoryService**:

Мы удалим изображение категории из папки и базы данных:
```
public function deleteSizeChartImage(mixed $categoryId): array
{
    $sizeChartImage = Category::where('id', $categoryId)->value('size_chart');
    if ($sizeChartImage) {
        $sizeChartImagePath = 'front/images/size-charts/' . $sizeChartImage;
        if (file_exists(public_path($sizeChartImagePath))) {
            unlink(public_path($sizeChartImagePath));
        }
        Category::where('id', $categoryId)->update(['size_chart' => null]);
        return ['status' => true, 'message' => 'Size Chart image deleted successfully!'];
    }
    return ['status' => false, 'message' => 'Size Chart image not found!'];
}
```
# Что дальше?
В [следующей части](26.md) мы начнем работать над ролями и разрешениями для категорий.

[Оглавление](../README.md)
