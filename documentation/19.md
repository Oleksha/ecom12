# Часть 19. Модуль «Категории» (I) | Создание таблицы и начальное заполнение категорий

В этой части мы начнём разработку основных функций электронной коммерции, начав с модуля «Категории». Категории играют ключевую роль в организации товаров для улучшения процесса покупок.

Мы разработаем гибкую иерархическую структуру (Категории → Подкатегории → Под-подкатегории) и вставим некоторые исходные данные для тестирования.

Что вы узнаете из этого видео:
- Обзор структуры категорий на сайте электронной коммерции
- Как создать таблицу категорий с помощью миграции
- Как создать ```CategoryController``` для обработки CRUD-операций
- Как заполнить таблицу категорий начальными записями с помощью ```Seeder```
- Как зарегистрировать и запустить сеялку для вставки данных в базу данных

### Обзор структуры категорий:

#### Категории
- Одежда
- Электроника
- Бытовая техника
#### Подкатегории
- Одежда → Мужчины, Женщины, Дети
- Электроника → Мобильные телефоны, компьютеры, телевизоры, фотоаппараты, наушники
- Бытовая техника → Кондиционеры, холодильники, стиральные машины

#### Под-подкатегории
- Мужчины → Рубашки, футболки
- Женщины → Топы, платья
- Дети → Футболки, шорты
## Шаг 1. Создать таблицу категорий

Для начала нам нужно создать таблицу в базе данных для хранения наших категорий. Она будет включать основные категории, их подкатегории и под-подкатегории, образуя полную иерархию.

Создайте модель и выполните миграцию с помощью Artisan:
```
php artisan make:model Category -m
```
Затем откройте сгенерированный файл миграции, расположенный в ```database/migrations/```, и обновите схему, включив в нее все обязательные поля, такие как parent_id, name, image, url, поля SEO и флаги статуса:
```
Schema::create('categories', function (Blueprint $table) {
    $table->id();
    $table->integer('parent_id')->nullable();
    $table->string('name');
    $table->string('image')->nullable();
    $table->string('size_chart')->nullable();
    $table->float('discount')->default(0.00);
    $table->text('description')->nullable();
    $table->string('url')->unique();
    $table->string('meta_title')->nullable();
    $table->string('meta_description')->nullable();
    $table->string('meta_keywords')->nullable();
    $table->tinyInteger('menu_status')->default(1);
    $table->tinyInteger('status')->default(1);
    $table->timestamps();
});
```
Наконец, запустите миграцию:
```
php artisan migrate
```
## Шаг 2. Создать ```CategoryController```

Как только таблица будет готова, следующим шагом станет обработка операций, связанных с категориями, в нашем приложении Laravel.

Создайте контроллер ресурсов внутри папки ```Admin```:
```
php artisan make:controller Admin/CategoryController --resource
```
Это создаст контроллер, в который мы позже сможем добавить логику для добавления, обновления, перечисления и удаления категорий.

## Шаг 3. Создание и заполнение начальных категорий

Для заполнения таблицы категорий начальными записями мы воспользуемся инструментом ***Laravel Database Seeder***. Это позволяет быстро добавлять примеры данных для тестирования и разработки, не добавляя их вручную через пользовательский интерфейс.

Создайте новый класс seeder:
```
php artisan make:seeder CategoryTableSeeder
```
Это создаст файл ```CategoryTableSeeder.php``` в каталоге ```database/seeders/```.

Теперь откройте файл посева и определите начальные записи:
```
namespace Database\Seeders;

use App\Models\Category;
use Carbon\Carbon;
use Illuminate\Database\Seeder;

class CategoryTableSeeder extends Seeder
{
    /**
     * Run the database seeds.
     */
    public function run(): void
    {
        $categories = [
            ['parent_id' => null, 'name' => 'Одежда', 'url' => 'clothing'],
            ['parent_id' => null, 'name' => 'Электроника', 'url' => 'electronics'],
            ['parent_id' => null, 'name' => 'Бытовая техника', 'url' => 'appliances'],
            ['parent_id' => 1, 'name' => 'Мужская', 'url' => 'men'],
            ['parent_id' => 1, 'name' => 'Женская', 'url' => 'women'],
            ['parent_id' => 1, 'name' => 'Детская', 'url' => 'kids'],
        ];
        foreach ($categories as $data) {
            Category::create([
                'parent_id' => $data['parent_id'],
                'name' => $data['name'],
                'url' => $data['url'],
                'image' => '',
                'size_chart' => '',
                'discount' => 0,
                'description' => '',
                'meta_title' => '',
                'meta_description' => '',
                'meta_keywords' => '',
                'status' => 1,
                'menu_status' => 1,
                'created_at' => Carbon::now(),
                'updated_at' => Carbon::now(),
            ]);
        }
    }
}
```
## Шаг 4. Зарегистрируйте ```Seeder``` в ```DatabaseSeeder.php```

Чтобы убедиться, что наш ```Seeder``` работает, мы должны зарегистрировать ее в основном файле ```DatabaseSeeder.php```.

Откройте ```database/seeders/DatabaseSeeder.php``` и добавьте:
```
$this->call(CategoryTableSeeder::class);
```
## Шаг 5. Запустить сеялку

Теперь выполните следующую команду, чтобы вставить записи категорий в базу данных:
```
php artisan db:seed --class CategoryTableSeeder
```
Это позволит вставить категории верхнего уровня, такие как «Одежда», «Электроника» и «Бытовая техника», а также подкатегории, такие как «Мужчины», «Женщины» и «Дети», в раздел «Одежда».

# Что дальше?

Теперь, когда таблица категорий готова и заполнена демонстрационными данными, в [следующей части](20.md) мы перейдём к отображению категорий и подкатегорий в панели администратора. Следите за новостями!

[Оглавление](../README.md)
