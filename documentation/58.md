# Часть 58. Динамическое отображение изображений и логотипов категорий на главной странице
В этой части серии мы улучшим макет домашней страницы, динамически отображая:
1. Категории домашней страницы с изображениями

Категории извлекаются из базы данных вместе с их изображениями и отображаются в виде сетки. Это улучшает визуальную привлекательность и позволяет покупателям легко переходить на страницы товаров, соответствующих категориям.
2. Логотип Баннеры Карусель

Логотипы партнеров или брендов динамически извлекаются из таблицы баннеров (тип = «Логотип») и отображаются с помощью Owl Carousel для создания элегантного анимированного эффекта слайдера.

Это гарантирует, что ваша домашняя страница будет полностью динамической, удобной для поставщиков и простой в управлении с панели администратора.

Это гарантирует, что ваша домашняя страница будет полностью динамической, удобной для поставщиков и простой в управлении с панели администратора.

**Отображение категорий на главной странице с изображениями**
## Шаг 1: Создайте функцию homeCategories в IndexService
Мы создадим эту функцию для извлечения категорий верхнего уровня и общего количества их товаров, включая подкатегории и подподкатегории.
```php
public function homeCategories(): array
{
    $categories = Category::select('id','name', 'image', 'url')
        ->whereNull('parent_id') // Извлекать только категории верхнего уровня (родительские)
        ->where('status', 1) // Только активные категории
        ->where('menu_status', 1) //Только категории, отмеченные для показа в меню/на главной странице
        ->get()
        ->map(function ($category) {
            $allCategoryIds = $this->getAllCategoryIds($category->id); // Получить эту категорию + идентификаторы ее подкатегорий
            $productCount = Product::whereIn('category_id', $allCategoryIds)
                ->where('status', 1)
                ->where('stock', '>', 0)
                ->count(); // Подсчет активных и имеющихся на складе товаров на всех уровнях
            return [
                'id' => $category->id,
                'name' => $category->name,
                'image' => $category->image,
                'url' => $category->url,
                'product_count' => $productCount, // Добавляем количество продуктов к каждой категории
            ];
        });
    return ['categories' => $categories->toArray()];
}
```
## Шаг 2: Создайте вспомогательную функцию getAllCategoryIds в IndexService
Теперь мы создадим рекурсивную вспомогательную функцию для получения всех дочерних категорий и их дочерних элементов и т.д.
```php
private function getAllCategoryIds($parentId): array
{
    $categoryIds = [$parentId]; // Начать с текущей родительской категории
    $childIds = Category::where('parent_id', $parentId)
        ->where('status', 1)
        ->pluck('id'); // Получить идентификаторы дочерних категорий
    foreach ($childIds as $childId) {
        $categoryIds = array_merge($categoryIds, $this->getAllCategoryIds($childId)); // Рекурсивно для получения под-подкатегорий
    }
    return $categoryIds; // Вернуть все идентификаторы дочерних и под-дочерних категорий
}
```
## Шаг 3. Обновите метод индекса в IndexController.
Теперь мы вызовем функцию homeCategories в функции index, чтобы получить подробную информацию о категориях.
```php
public function index()
{
    $banners = $this->indexService->getHomePageBanners();
    $featured = $this->indexService->featuredProducts();
    $newArrivals = $this->indexService->newArrivalProducts();
    $categories = $this->indexService->homeCategories(); // Теперь включает категории
    return view('front.index')
        ->with($banners)
        ->with($featured)
        ->with($newArrivals)
        ->with($categories); // Передать категории в вид
}
```
## Шаг 4: Код Blade в index.blade.php
Теперь добавим цикл **foreach** для отображения всех основных категорий с их названиями и изображениями.
```html
<!-- Categories Start -->
<div class="container-fluid pt-2">
    <div class="row px-xl-5 pb-3">
        @foreach($categories as $category)
        @php
        $image = !empty($category['image'])
        ? asset('front/images/categories/' . $category['image'])
        : asset('front/images/no-image.png');
        @endphp
        <div class="col-lg-4 col-md-6 pb-1">
            <div class="cat-item d-flex flex-column border mb-4" style="padding: 30px;">
                <p class="text-right">{{ $category['product_count'] }} товаров</p>
                <a href="{{ url('category/' . $category['url']) }}" class="cat-img position-relative overflow-hidden mb-3">
                    <img class="img-fluid" src="{{ $image }}" alt="{{ $category['name'] }}">
                </a>
                <h5 class="font-weight-semi-bold m-0">{{ $category['name'] }}</h5>
            </div>
        </div>
        @endforeach
    </div>
</div>
<!-- Categories End -->
```
**Динамическое отображение баннеров с логотипами**
## Шаг 1. Обновите функцию getHomePageBanners в IndexService.
Мы обновим функцию getHomePageBanners в IndexService, чтобы получить баннеры с логотипом типа Logo.
```php
public function getHomePageBanners(): array
{
    $homeSliderBanners = Banner::where('type', 'Slider')
        ->where('status', 1)
        ->orderBy('sort', 'desc')
        ->get()->toArray();

    $homeFixBanners = Banner::where('type', 'Fix')
        ->where('status', 1)
        ->orderBy('sort', 'desc')
        ->get()->toArray();
    
    $logoBanners = Banner::where('type', 'Logo')
        ->where('status', 1)
        ->orderByDesc('sort')
        ->get()->toArray();

    return compact('homeSliderBanners', 'homeFixBanners', 'logoBanners');
}
```
## Шаг 2: Код Blade в index.blade.php
Теперь мы будем динамически показывать логотипы-баннеры в цикле foreach на домашней странице.
```html
<div class="container-fluid py-2">
    <div class="row px-xl-5">
        <div class="col">
            <div class="owl-carousel vendor-carousel">
                @foreach($logoBanners as $logo)
                    <div class="vendor-item border p-4">
                        <img src="{{ asset('front/images/banners/' . $logo['image']) }}" alt="{{ $logo['title'] }}">
                    </div>
                @endforeach
            </div>
        </div>
    </div>
</div>
```
# Что дальше?
В [следующей части](59.md) мы будем работать над страницей категорий.

[Оглавление](../README.md)
