# Часть 11. Смена пароля администратора (II) | Проверить текущий пароль
В этой части мы проверим корректность текущего пароля, указанного администратором в форме обновления пароля. Мы проверим его с помощью AJAX и выведем сообщение рядом с полем «Текущий пароль» в форме обновления пароля.
## Шаг 1. Внедрить AdminService в AdminController
Мы внедрим ```AdminService``` в ```AdminController```, используя внедрение зависимостей на основе конструктора в ```AdminController.php```:
```php
namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Services\Admin\AdminService;
use Illuminate\Support\Facades\Session;

class AdminController extends Controller
{
    public function __construct(
        protected AdminService $adminService
    )
    {}

    public function store(LoginRequest $request)
    {
        $data = $request->all();
        $loginStatus = $this->adminService->login($data);
        if ($loginStatus == 1) {
            return redirect()->route('dashboard.index');
        } else {
            return redirect()->back()->with('error_message', 'Invalid Email or Password');
        }
    }
}
```
## Шаг 2. Создайте файл custom.js
Теперь создадим файл ```custom.js``` в папке ```/public/admin/js/```. Затем добавим код ```jQuery/AJAX``` для проверки корректности текущего пароля, введённого администратором 
в файл ```/public/admin/js/custom.js```:
```js
$(document).ready(function(){
    // Check Admin Password is correct or not
    $("#current_pwd").keyup(function () {
        let current_pwd = $("#current_pwd").val();
        $.ajax({
            headers: {
                'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
            },
            type: "POST",
            url: "/admin/verify-password",
            data: { current_pwd: current_pwd },
            success: function (response) {
                if (response === "false") {
                    $("#verifyPwd").html("<font color='red'>Введенный пароль не корректен</font>");
                } else {
                    $("#verifyPwd").html("<font color='green'>Введен корректный пароль</font>");
                }
            },
            error: function () {
                alert("Error");
            }
        });
    });
});
```
## Шаг 3. Добавьте CSRF-токен в layout.blade.php
Добавьте токен CSRF в файл макета layout.blade.php:
```html
<meta name="csrf-token" content="{{ csrf_token() }}">
```
## Шаг 4. Обновите файл scripts.blade.php
Включите файл ```custom.js``` и ссылку ```jQuery CDN``` в ```scripts.blade.php```:
```html
<!-- jQuery -->
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<!-- Custom Script -->
<script src="{{ asset('admin/js/custom.js') }}"></script>
```
## Шаг 5. Создать маршрут
Создайте маршрут POST для проверки пароля в web.php:
```php
// Verify Password
Route::post('verify-password', [AdminController::class, 'verifyPassword'])->name('admin.verify-password');
```
## Шаг 6. Создайте функцию проверки пароля() в AdminService и AdminController
Создайте функцию ```verifyPassword()``` в ```AdminService``` для проверки правильности текущего пароля администратора:
```php
public function verifyPassword($data): string
{
    if (Hash::check($data['current_pwd'], Auth::guard('admin')->user()->password)) {
        return "true";
    } else {
        return "false";
    }
}
```
Добавьте функцию в ```AdminController.php```:
```php
// Verify Admin Password using AdminService
public function verifyPassword(Request $request)
{
    $data = $request->all();
    return $this->adminService->verifyPassword($data);
}
```
Функция ```verifyPassword()``` получает данные запроса и передает их функции ```verifyPassword()``` в ```AdminService```.

Ответ возвращается непосредственно в запрос AJAX.

Это позволяет администратору в режиме реального времени получать обратную связь о текущем статусе пароля.
## Шаг 7. Обновите форму для отображения ответного сообщения
Добавьте пробел под полем текущего пароля, чтобы отобразить сообщение об успехе/ошибке в ```update_password.blade.php```:
```html
<label for="current_pwd" class="form-label">Current Password</label>
<input type="password" class="form-control" id="current_pwd" name="current_pwd">
<span id="verifyPwd"></span>
```
**Как это работает?**
- Если введенный пароль правильный → «Текущий пароль верный» (зелёным цветом)
- Если введенный пароль неверен → «Текущий пароль неверный» (красным)

**Почему внедрение на основе конструктора лучше?**
- Способствует более чистому коду
- Уменьшает повторение кода
- Улучшает тестируемость
- Делает логику обслуживания более организованной
# Что дальше?
В [следующей части](12.md) мы, наконец, обновим пароль и разрешим вход с обновленным паролем.

[Оглавление](../README.md)
