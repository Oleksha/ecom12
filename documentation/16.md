# Часть 16. Роли и разрешения (II) | Активные/Неактивные/Удалить субадминистраторов
В этой части мы продолжим работу над ролями и разрешениями субадминистраторов, реализуя функции активации, деактивации и удаления в панели администратора. Это позволит администратору эффективно управлять субадминистраторами, предоставляя/отключая им доступ и удаляя их при необходимости.

К концу этого урока вы сможете:
- Динамическое переключение активного/неактивного статуса субадминистраторов.
- Реализовать функцию удаления для субадминистраторов.
- Используйте атрибуты данных в jQuery для улучшенной обработки AJAX.
## Шаг 1. Обновите FontAwesome в styles.blade.php
Добавьте последнюю версию FontAwesome CDN, чтобы использовать значки для переключателей «Активно/Неактивно» и действий «Удалить».
```html
<!-- Font Awesome CSS -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
```
## Шаг 2. Обновите subadmins.blade.php для отображения статуса «Активно/Неактивно».
Отображение значков переключения для активного/неактивного статуса субадминистраторов.

Используйте атрибуты данных jQuery вместо идентификатора для динамической передачи идентификатора субадминистратора.
```html
<td>
    @if($subadmin->status == 1)
        <a class="updateSubadminStatus" data-subadmin-id="{{ $subadmin->id }}" style="color: #3f6ed3" href="javascript:void(0)"><i class="fas fa-toggle-on" data-status="Active"></i></a>
    @else
        <a class="updateSubadminStatus" data-subadmin-id="{{ $subadmin->id }}" style="color: gray" href="javascript:void(0)"><i class="fas fa-toggle-off" data-status="Inactive"></i></a>
    @endif
</td>
```
## Шаг 3. Обработка обновления статуса с помощью AJAX в custom.js
Используйте jQuery для отправки текущего статуса и идентификатора субадминистратора на сервер.

Динамически обновляйте значок без обновления страницы.
```js
// Update Subadmin Status
$(document).on("click", ".updateSubadminStatus", function(){
    let status = $(this).children('i').data('status');
    let subadmin_id = $(this).data('subadmin-id');
    $.ajax({
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        },
        type: "POST",
        url: "/admin/update-subadmin-status",
        data: { status: status, subadmin_id: subadmin_id},
        success: function (response) {
            if (response['status'] === 0) {
                $("a[data-subadmin-id='" + subadmin_id + "']").html("<i class='fa fa-toggle-off' style='color: gray' data-status='Inctive'></i>");
            } else if (response['status'] === 1) {
                $("a[data-subadmin-id='" + subadmin_id + "']").html("<i class='fa fa-toggle-on' style='color: #3f6ed3' data-status='Active'></i>");
            }
        },
        error: function () {
            alert("Error");
        }
    });
});
```
## Шаг 4. Создать маршрут для обновления статуса
Определите маршрут ```POST``` в ```web.php``` для обработки обновлений статуса субадминистратора.
```php
Route::post('update-subadmin-status', [AdminController::class, 'updateSubadminStatus']);
```
## Шаг 5. Обновление updateSubadminStatus в AdminController
Используйте внедрение зависимостей вместо создания нового экземпляра ```AdminService```.
```php
public function updateSubadminStatus(Request $request)
{
    if ($request->ajax()) {
        $data = $request->all();
        $status = $this->adminService->updateSubadminStatus($data);
        return response()->json(['status' => $status, 'subadmin_id' => $data['subadmin_id']]);
    }
}
```
## Шаг 6. Реализуйте updateSubadminStatus в AdminService
Обновить статус в базе данных и вернуть обновленное значение.
```php
public function updateSubadminStatus($data): int
{
    $status = ($data['status'] == "Active") ? 0 : 1;
    Admin::where('id', $data['subadmin_id'])->update(['status' => $status]);
    return $status;
}
```
## Шаг 7. Реализация удаления субадминистратора (традиционный подход Laravel/PHP)
Теперь мы реализуем функционал удаления для субадминистраторов, используя стандартный подход Laravel/PHP.

Далее в этой серии мы улучшим это, реализовав удаление на основе AJAX для более удобного использования.
### 7.1 Обновление subadmins.blade.php
Добавьте значок удаления рядом с каждым субадминистратором.
```html
<a class="ms-2" style="color: #3f6ed3" title="Delete Subadmin" href="{{ url('admin/delete-subadmin/' . $subadmin->id) }}"><i class="fas fa-trash"></i></a>
```
## Шаг 8. Создать маршрут для удаления субадминистраторов
Определите маршрут ```GET``` в ```web.php``` для удаления субадминистраторов.
```php
Route::get('delete-subadmin/{id}', [AdminController::class, 'deleteSubadmin']);
```
## Шаг 9. Обновление deleteSubadmin в AdminController
Вызовите функцию AdminService для удаления субадминистраторов и возврата сообщения об успешном завершении.
```php
public function deleteSubadmins(string $id)
{
    $result = $this->adminService->deleteSubadmins($id);
    return redirect()->back()->with('success_message', $result['message']);
}
```
## Шаг 10. Реализуйте deleteSubadmin в AdminService
Удалить субадминистратора из базы данных и вернуть ответ об успешном завершении.
```php
public function deleteSubadmins(string $id): array
{
    // Delete Sub Admin
    Admin::where('id', $id)->delete();
    $message = "Subadmin deleted successfully!";
    return array("message" => $message);
}
```
### Показывать сообщения об успешном завершении в subadmins.blade.php
Отображать оповещение об успешном удалении субадминистратора.
```html
@if(Session::has('success_message'))
    <div class="alert alert-success alert-dismissible fade show m-3">
        <strong>Success: </strong> {{ Session::get('success_message') }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
@endif
```
# Что дальше?
В [следующей части](17.md) мы реализуем функцию «Добавить субадминистратора», которая позволит администраторам создавать новые учётные записи субадминистраторов с определёнными ролями и разрешениями!

[Оглавление](../README.md)
