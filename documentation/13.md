# Часть 13. Обновить данные администратора (I) | Создать страницу данных администратора
В этой части мы начнем работу над обновлением и проверкой данных администратора, таких как имя администратора и номер мобильного телефона.

Мы создадим страницу и форму с данными администратора, добавим валидацию формы и реализуем функционал обновления данных администратора в базе данных. В этой части мы рассмотрим создание маршрута, формы, валидацию запроса и функцию контроллера для обновления данных администратора.
## Шаг 1. Создать маршрут:
Создайте маршрут ```GET``` для отображения формы данных администратора в файле ```web.php```:
```php
Route::get('update-details', [AdminController::class, 'editDetails'])->name('admin.update-details');
```
## Шаг 2. Создать функцию editDetails:
Создайте функцию ```editDetails``` в ```AdminController``` для вызова файла ```update_details.blade.php```:
```php
public function editDetails()
{
    Session::put('page', 'update-details');
    return view('admin.update-details');
}
```
## Шаг 3. Создайте файл update_details.blade.php:
Создайте файл ```update_details.blade.php``` в папке ```resources/views/admin/```.

Создайте форму данных администратора с полями имени администратора, электронной почты и мобильного телефона (укажите только для чтения) адрес электронной почты:
```html
<form method="post" action="{{ route('admin.update-details.request') }}">@csrf
    <!--begin::Body-->
    <div class="card-body">
        <div class="mb-3">
            <label for="email" class="form-label">Email address</label>
            <input type="email" class="form-control" id="email"
                   value="{{ Auth::guard('admin')->user()->email }}" readonly
                   style="background-color: #cccccc;">
        </div>
        <div class="mb-3">
            <label for="name" class="form-label">Name</label>
            <input type="text" class="form-control" id="name" name="name"
                   value="{{ Auth::guard('admin')->user()->name }}">
        </div>
        <div class="mb-3">
            <label for="mobile" class="form-label">Mobile</label>
            <input type="text" class="form-control" id="mobile" name="mobile"
                   value="{{ Auth::guard('admin')->user()->mobile }}">
        </div>
    </div>
    <!--end::Body-->
    <!--begin::Footer-->
    <div class="card-footer">
        <button type="submit" class="btn btn-primary">Submit</button>
    </div>
    <!--end::Footer-->
</form>
```
## Шаг 4. Создать маршрут POST:
Создайте маршрут ```POST``` для обновления данных администратора в файле ```web.php```:
```php
Route::post('update-details', [AdminController::class, 'updateDetails'])-> name('admin.update-details.request');
```
## Шаг 5. Создайте функцию updateDetails в AdminService:
Создайте функцию ```updateDetails``` в ```AdminService``` для обновления данных администратора в таблице ```admins```:
```php
public function updateDetails($request)
{
    $data = $request->all();
    // Update Admin Details
    Admin::where('email',Auth::guard('admin')->user()->email)->update([
        'name' => $data['name'],
        'mobile' => $data['mobile'],
    ]);
}
```
## Шаг 6. Создайте DetailRequest для проверки:
Поскольку это часть панели администратора, мы создадим ```DetailRequest``` в папке ```Admin```, используя следующую команду:
```
php artisan make:request Admin/DetailRequest
```
Обновите ```DetailRequest.php```, добавив правила проверки и пользовательские сообщения:
```php
public function authorize(): bool
{
    return true;
}

public function rules(): array
{
    return [
        'name' => 'required|regex:/^[\pL\s\-]+$/u|max:255',
        'mobile' => 'required|numeric|digits:11',
    ];
}

public function messages(): array
{
    return [
        'name.required' => 'Name is required',
        'name.regex' => 'Valid name is required',
        'name.max' => 'Maximum length is 255 characters',
        'mobile.required' => 'Mobile is required',
        'mobile.numeric' => 'Valid mobile is numeric',
        'mobile.digits' => 'Valid mobile is digits',
    ];
}
```
Включить ```DetailRequest``` в верхнюю часть ```AdminController```:
```php
use App\Http\Requests\Admin\DetailRequest;
```
## Шаг 7. Создайте функцию updateDetails в AdminController:
Поскольку мы уже внедрили ```AdminService``` с помощью внедрения зависимости на основе конструктора, мы можем напрямую использовать ```$this->adminService``` для обновления данных администратора:
```php
public function updateDetails(DetailRequest $request)
{
    Session::put('page', 'update-details');
    if ($request->isMethod('post')) {
        $this->adminService->updateDetails($request);
        return redirect()->back()->with('success_message', 'Admin Details have been updated successfully!');
    }
}
```
## Шаг 8. Обновите файл update_details.blade.php:
Добавить div-блок предупреждений для отображения сообщений об успешном выполнении и ошибках в ```update_details.blade.php```:
```html
@if(Session::has('error_message'))
    <div class="alert alert-danger alert-dismissible fade show m-3" role="alert">
        <strong>Error: </strong> {{ Session::get('error_message') }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
@endif
@if(Session::has('success_message'))
    <div class="alert alert-success alert-dismissible fade show m-3" role="alert">
        <strong>Success: </strong> {{ Session::get('success_message') }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
@endif
@foreach($errors->all() as $error)
    <div class="alert alert-danger alert-dismissible fade show m-3" role="alert">
        <strong>Error! </strong> {!! $error !!}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
@endforeach
```
# Что дальше?
В [следующей части](14.md) мы добавим возможность добавлять и удалять фото администратора.

[Оглавление](../README.md)
