# Часть 54. Управление баннерами на главной странице (II) | Показывать баннеры с активным/неактивным переключением и удалением
В этой части мы реализовали управление баннерами панели администратора, в которой перечислены все баннеры домашней страницы и реализована возможность переключения статуса (активный/неактивный) и удаления с использованием AJAX и доступа на основе ролей.

Реализованные возможности:
- Показывать все баннеры в панели администратора (изображение, заголовок, тип и т. д.)
- Переключение статуса баннера с помощью AJAX
- Удалить баннеры из БД и папки
- Ограничить доступ с помощью разрешений роли администратора (просмотр/редактирование/полный)
- Флэш-сообщения об успешном завершении/ошибке
## Шаг 1: Создание контроллера ресурсов баннера
```
php artisan make:controller Admin/BannerController --resource
```
## Шаг 2: Определите маршруты в web.php
```php
// Баннеры
Route::resource('banners', BannerController::class);
Route::post('update-banner-status', [BannerController::class, 'updateBannerStatus']);
```
## Шаг 3: Создайте BannerService.php
Расположение: **App\Services\Admin\BannerService.php**
```php
namespace App\Services;

use App\Models\AdminsRole;
use App\Models\Banner;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\File;

class BannerService
{
    /**
     * Get all banners and module permissions
     */
    public function banners()
    {
        $admin = Auth::guard('admin')->user();
        $banners = Banner::orderBy('sort')->get();
        $bannersModuleCount = AdminsRole::where([
            'subadmin_id' => $admin->id,
            'module' => 'banners',
        ])->count();

        $bannersModule = [];

        if ($admin->role == 'admin') {
            $bannersModule = [
                'view_access' => 1,
                'edit_access' => 1,
                'full_access' => 1,
            ];
        } elseif ($bannersModuleCount == 0) {
            return [
                'status' => 'error',
                'message' => 'This feature is restricted for you!'
            ];
        } else {
            $bannersModule = AdminsRole::where([
                'subadmin_id' => $admin->id,
                'module' => 'banners',
            ])->first()->toArray();
        }

        return [
            'status' => 'success',
            'banners' => $banners,
            'bannersModule' => $bannersModule,
        ];
    }

    /**
     * Update banner status via AJAX
     */
    public function updateBannerStatus($data): int
    {
        $status = ($data['status'] == 'Active') ? 0 : 1;
        Banner::where('id', $data['id'])->update(['status' => $status]);
        return $status;
    }

    /**
     * Delete a banner
     */
    public function deleteBanner($id): array
    {
        $banner = Banner::findOrFail($id);
        $bannerImagePath = public_path('front/images/banners/' . $banner->image);

        if (File::exists($bannerImagePath)) {
            File::delete($bannerImagePath);
        }

        $banner->delete();

        return ['status' => 'success', 'message' => 'Banner deleted successfully!'];
    }
}
```
## Шаг 4: Обновите BannerController.php
```php
namespace App\Http\Controllers\Admin;

use App\Http\Controllers\Controller;
use App\Models\ColumnPreference;
use App\Services\BannerService;
use Illuminate\Http\Request;
use Illuminate\Support\Facades\Auth;
use Illuminate\Support\Facades\Session;

class BannerController extends Controller
{
    public function __construct(
        protected BannerService $bannerService
    )
    {}

    /**
     * Display a listing of the resource.
     */
    public function index()
    {
        Session::put('page', 'banners');
        $result = $this->bannerService->banners();
        if ($result['status'] == 'error') {
            return redirect('admin/dashboard')->with('error_message', $result['message']);
        }

        $banners = $result['banners'];
        $bannersModule = $result['bannersModule'];

        $columnPrefs = ColumnPreference::where('admin_id', Auth::guard('admin')->id())
            ->where('table_name', 'banners')
            ->first();

        $bannersSavedOrder = $columnPrefs ? json_decode($columnPrefs->column_order, true) : null;
        $bannersHiddenCols = $columnPrefs ? json_decode($columnPrefs->hidden_columns, true) : [];

        return view('admin.banners.index', compact(
            'banners',
            'bannersModule',
            'bannersSavedOrder',
            'bannersHiddenCols'));
    }

    /**
     * Remove the specified resource from storage.
     */
    public function destroy(string $id)
    {
        $result = $this->bannerService->deleteBanner($id);
        return redirect()->back()->with('success_message', $result['message']);
    }

    /**
     * Update banner status using AJAX
     */
    public function updateBannerStatus(Request $request)
    {
        if ($request->ajax()) {
            $data = $request->all();
            $status = $this->bannerService->updateBannerStatus($data);
            return response()->json(['status' => $status, 'id' => $data['id']]);
        }
    }
}
```
## Шаг 5: Создайте Blade-файл 
По следующему пути **resources/views/admin/banners/index.blade.php**
```html
@extends('admin.layout.layout')
@section('content')
    <main class="app-main">
        <!--begin::App Content Header-->
        <div class="app-content-header">
            <!--begin::Container-->
            <div class="container-fluid">
                <!--begin::Row-->
                <div class="row">
                    <div class="col-sm-6"><h3 class="mb-0">Управление баннерами</h3></div>
                    <div class="col-sm-6">
                        <ol class="breadcrumb float-sm-end">
                            <li class="breadcrumb-item"><a href="#">Home</a></li>
                            <li class="breadcrumb-item active" aria-current="page">Баннеры</li>
                        </ol>
                    </div>
                </div>
                <!--end::Row-->
            </div>
            <!--end::Container-->
        </div>
        <!--end::App Content Header-->
        <!--begin::App Content-->
        <div class="app-content">
            <!--begin::Container-->
            <div class="container-fluid">
                <!--begin::Row-->
                <div class="row">
                    <div class="col-md-12">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h3 class="card-title">Баннеры</h3>
                                @if($bannersModule['edit_access'] == 1 || $bannersModule['full_access'] == 1)
                                    <a style="max-width: 250px; float:right; display: inline-block;"
                                       href="{{ route('banners.create') }}"
                                       class="btn btn-block btn-primary">
                                        Добавить баннер
                                    </a>
                                @endif
                            </div>
                            <!-- /.card-header -->
                            <div class="card-body">
                                @if(Session::has('success_message'))
                                    <div class="alert alert-success alert-dismissible fade show mb-3" role="alert">
                                        <strong>Success: </strong> {{ Session::get('success_message') }}
                                        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                                    </div>
                                @endif
                                <table id="banners" class="table table-bordered table-striped">
                                    <thead>
                                    <tr>
                                        <th>Image</th>
                                        <th>Type</th>
                                        <th>Link</th>
                                        <th>Title</th>
                                        <th>Alt</th>
                                        <th>Sort</th>
                                        <th>Actions</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                    @foreach($banners as $banner)
                                        <tr>
                                            <td>
                                                <img src="{{ asset('front/images/banners/' . $banner->image) }}" width="100" alt="">
                                            </td>
                                            <td>{{ $banner->type }}</td>
                                            <td>{{ $banner->link }}</td>
                                            <td>{{ $banner->title }}</td>
                                            <td>{{ $banner->alt }}</td>
                                            <td>{{ $banner->sort }}</td>
                                            <td>{{ $banner->created_at->format('F j, Y, g:i a') }}</td>
                                            <td>
                                                @if($bannersModule['edit_access'] == 1 || $bannersModule['full_access'] == 1)
                                                    @if($banner->status == 1)
                                                        <a class="updateBrandStatus me-2"
                                                           data-id="{{ $banner->id }}"
                                                           style="color: #3f6ed3" href="javascript:void(0)"><i class="fas fa-toggle-on" data-status="Active"></i></a>
                                                    @else
                                                        <a class="updateBrandStatus me-2"
                                                           data-id="{{ $banner->id }}"
                                                           style="color: grey" href="javascript:void(0)"><i class="fas fa-toggle-off" data-status="Inactive"></i></a>
                                                    @endif
                                                    <a class="me-2" href="{{ route('banners.edit', $banner->id) }}"><i class="fas fa-edit"></i></a>
                                                    @if($brandsModule['full_access'] == 1)
                                                        <form action="{{ route('banners.destroy', $banner->id) }}"
                                                              method="POST" style="display: inline-block">
                                                            @csrf
                                                            @method('DELETE')
                                                            <button class="confirmDelete"
                                                                    name="Banner"
                                                                    title="DeleteBanner"
                                                                    type="button"
                                                                    data-module="banners"
                                                                    data-id="{{ $banner->id }}"
                                                                    style="border: none; background: none; color: #3f6ed3">
                                                                <i class="fas fa-trash"></i>
                                                            </button>
                                                        </form>
                                                    @endif
                                                @endif
                                            </td>
                                        </tr>
                                    @endforeach
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <!--end::Row-->
            </div>
            <!--end::Container-->
        </div>
        <!--end::App Content-->
    </main>
@endsection
```
## Шаг 6: Добавьте скрипт jQuery в custom.js
```js
// Update Banner Status
$(document).on("click", ".updateBannerStatus", function(){
    let status = $(this).children('i').data('status');
    let id = $(this).data('id');
    $.ajax({
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        },
        type: "POST",
        url: "/admin/update-banner-status",
        data: { status: status, id: id},
        success: function (response) {
            if (response['status'] === 0) {
                $("a[data-id='" + id + "']").html("<i class='fa fa-toggle-off' style='color: gray' data-status='Inctive'></i>");
            } else if (response['status'] === 1) {
                $("a[data-id='" + id + "']").html("<i class='fa fa-toggle-on' style='color: #3f6ed3' data-status='Active'></i>");
            }
        },
        error: function () {
            alert("Error");
        }
    });
});
```
# Что дальше?
В [следующей части](55.md) мы начнем делать домашнюю страницу динамичной, загружая из базы данных контент, такой как баннеры, избранные категории и многое другое.

[Оглавление](../README.md)
