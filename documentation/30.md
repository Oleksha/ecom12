# Часть 30. Модуль «Продукты» (III) | Активный/Неактивный и Удаление продуктов
В этой части мы улучшим модуль «Продукты», реализовав следующие функции:
- Изменить статус продукта (активный/неактивный)
- Удалить продукт

Эти функции необходимы для поддержания чистоты и управляемости данных о продуктах в вашей панели администратора.
## Шаг 1. Обновите products/index.blade.php для отображения значков статуса.
Обновите представление Blade для отображения значков переключения с помощью Font Awesome:
```
<td>
    @if($product->status == 1)
        <a class="updateProductStatus" data-product-id="{{ $product->id }}" 
           style="color: #3f6ed3" href="javascript:void(0)"><i class="fas fa-toggle-on" data-status="Active"></i></a>
    @else
        <a class="updateProductStatus" data-product-id="{{ $product->id }}"
           style="color: gray" href="javascript:void(0)"><i class="fas fa-toggle-off" data-status="Inactive"></i></a>
    @endif
</td>
```
## Шаг 2. Добавьте логику jQuery в custom.js для обновления статуса AJAX
```
// Update Product Status
$(document).on("click", ".updateProductStatus", function(){
    let status = $(this).children('i').data('status');
    let product_id = $(this).data('product-id');
    $.ajax({
        headers: {
            'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
        },
        type: "POST",
        url: "/admin/update-product-status",
        data: { status: status, product_id: product_id},
        success: function (response) {
            if (response['status'] === 0) {
                $("a[data-product-id='" + product_id + "']").html("<i class='fa fa-toggle-off' style='color: gray' data-status='Inctive'></i>");
            } else if (response['status'] === 1) {
                $("a[data-product-id='" + product_id + "']").html("<i class='fa fa-toggle-on' style='color: #3f6ed3' data-status='Active'></i>");
            }
        },
        error: function () {
            alert("Error");
        }
    });
});
```
## Шаг 3. Создать маршрут для обновления статуса
В ```route/web.php``` добавьте:
```
Route::post('update-product-status', [ProductController::class, 'updateProductStatus']);
```
## Шаг 4. Создайте метод updateProductStatus в ProductController
```
public function updateProductStatus(Request $request)
{
    if ($request->ajax()) {
        $data = $request->all();
        $status = $this->productService->updateProductStatus($data);
        return response()->json(['status' => $status, 'product_id' => $data['product_id']]);
    }
}
```
## Шаг 5. Создайте метод updateProductStatus в ProductService
```
public function updateProductStatus($data): int
{
    $status = ($data['status'] == 'Active') ? 0 : 1;
    Product::where('id', $data['product_id'])->update(['status' => $status]);
    return $status;
}
```
# Функциональность удаления продукта
## Шаг 6. Добавить значок «Удалить» в представление Blade
Обновление ```products/index.blade.php```:
```
<form action="{{ route('products.destroy', $product->id) }}" 
      method="POST" style="display: inline-block;">
    @csrf
    @method('DELETE')
    <button class="confirmDelete"
            name="Product"
            title="Delete Product"
            type="button"
            data-module="product"
            data-id="{{ $product->id }}"
            style="border: none; background: none; color: #3f6ed3">
        <i class="fas fa-trash"></i>
    </button>
</form>
```
## Шаг 7. Обновите метод destroy() в ProductController
```
public function destroy(string $id)
{
    $result = $this->productService->deleteProduct($id);
    return redirect()->back()->with('success_message', $result['message']);
}
```
## Шаг 8. Обработка удаления в ProductService
```
public function deleteProduct(string $id): array
{
    Product::where('id', $id)->delete();
    $message = 'Product deleted successfully!';
    return ['message' => $message];
}
```
## Шаг 9. Добавить разрешения для Blade View
```
@if($productsModule['edit_access'] == 1 || $productsModule['full_access'] == 1)
    @if($product->status == 1)
        <a class="updateProductStatus" data-product-id="{{ $product->id }}"
           style="color: #3f6ed3" href="javascript:void(0)"><i class="fas fa-toggle-on" data-status="Active"></i></a>
    @else
        <a class="updateProductStatus" data-product-id="{{ $product->id }}"
           style="color: gray" href="javascript:void(0)"><i class="fas fa-toggle-off" data-status="Inactive"></i></a>
    @endif
    @if($productsModule['full_access'] == 1)
        <form action="{{ route('products.destroy', $product->id) }}"
              method="POST" style="display: inline-block;">
            @csrf
            @method('DELETE')
            <button class="confirmDelete"
                    name="Product"
                    title="Delete Product"
                    type="button"
                    data-module="product"
                    data-id="{{ $product->id }}"
                    style="border: none; background: none; color: #3f6ed3">
                <i class="fas fa-trash"></i>
            </button>
        </form>
    @endif
@endif
```
Конечный результат этой части:
- Мгновенное переключение статуса продукта через AJAX
- Безопасное удаление продукта из панели администратора
# Что дальше?
В [следующей части](31.md) мы отобразим категорию продукта и родительскую категорию вместе с подробной информацией о продукте на панели администратора.

[Оглавление](../README.md)
